<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GATE 2026 Interactive Preparation Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // --- IMPORTANT GLOBAL VARIABLES ---
        // These are provided by the environment and should not be changed.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        // --- END OF GLOBAL VARIABLES ---

        const statusConfig = {
            "Not Started": { color: 'bg-gray-400', text: 'text-gray-500' },
            "In Progress": { color: 'bg-blue-500', text: 'text-blue-600' },
            "Completed": { color: 'bg-indigo-500', text: 'text-indigo-600' },
            "Revised": { color: 'bg-purple-500', text: 'text-purple-600' },
            "Mastered": { color: 'bg-green-500', text: 'text-green-600' },
        };

        let progressChart;
        let currentFilter = 'All';
        let trackerData = [];
        let userId = null;
        let db;

        document.addEventListener('DOMContentLoaded', () => {
            setLogLevel('debug');
            initializeFirebase();
            setupChart();
            setupEventListeners();
        });

        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                db = getFirestore(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').textContent = userId;
                        // Listen for real-time changes to the tracker data
                        listenForTrackerData(userId);
                    } else {
                         console.log("Authentication state changed to signed out.");
                    }
                });

            } catch (error) {
                console.error("Firebase initialization or authentication failed:", error);
            }
        }
        
        function listenForTrackerData(currentUserId) {
            const dataDocRef = doc(db, `/artifacts/${appId}/users/${currentUserId}/data/tracker_data`);
            
            // Set up real-time listener
            onSnapshot(dataDocRef, (docSnap) => {
                if (docSnap.exists() && docSnap.data().data) {
                    try {
                        // Deserialize the data
                        trackerData = JSON.parse(docSnap.data().data);
                        renderTrackerList();
                        updateSummary();
                        console.log("Tracker data loaded from Firestore.");
                    } catch (e) {
                        console.error("Error parsing tracker data:", e);
                    }
                } else {
                    console.log("No existing data found, initializing with default data.");
                    initializeDefaultData();
                }
            }, (error) => {
                console.error("Error listening to Firestore document:", error);
            });
        }
        
        async function updateDataInFirestore() {
            if (!userId) {
                console.warn("User not authenticated, cannot save data.");
                return;
            }
            try {
                const dataDocRef = doc(db, `/artifacts/${appId}/users/${userId}/data/tracker_data`);
                // Serialize the data before saving
                const dataToSave = JSON.stringify(trackerData);
                await setDoc(dataDocRef, { data: dataToSave, lastUpdated: Date.now() });
                console.log("Tracker data saved to Firestore.");
            } catch (e) {
                console.error("Error writing document to Firestore:", e);
            }
        }
        
        function initializeDefaultData() {
            trackerData = [
                { id: 1, type: 'subject', name: 'General Aptitude', children: [2, 6, 10, 14] },
                { id: 2, type: 'topic', name: 'Verbal Ability', parent: 1, children: [3, 4, 5] },
                { id: 3, type: 'subtopic', parent: 2, name: 'English Grammar', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 4, type: 'subtopic', parent: 2, name: 'Reading Comprehension', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 5, type: 'subtopic', parent: 2, name: 'Sentence Completion', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 6, type: 'topic', name: 'Quantitative Aptitude', parent: 1, children: [7, 8, 9] },
                { id: 7, type: 'subtopic', parent: 6, name: 'Data Interpretation', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 8, type: 'subtopic', parent: 6, name: 'Numerical Computation', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 9, type: 'subtopic', parent: 6, name: 'Ratio & Proportion', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 10, type: 'topic', name: 'Analytical Aptitude', parent: 1, children: [11, 12, 13] },
                { id: 11, type: 'subtopic', parent: 10, name: 'Logical Reasoning', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 12, type: 'subtopic', parent: 10, name: 'Seating Arrangements', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 13, type: 'subtopic', parent: 10, name: 'Puzzles', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 14, type: 'topic', name: 'Spatial Aptitude', parent: 1, children: [15, 16, 17] },
                { id: 15, type: 'subtopic', parent: 14, name: 'Paper Folding', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 16, type: 'subtopic', parent: 14, name: 'Mirror Images', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 17, type: 'subtopic', parent: 14, name: 'Visual Comparison', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },

                { id: 18, type: 'subject', name: 'Engineering Mathematics', children: [19, 22, 26] },
                { id: 19, type: 'topic', name: 'Linear Algebra', parent: 18, children: [20, 21] },
                { id: 20, type: 'subtopic', parent: 19, name: 'Vector Spaces', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 21, type: 'subtopic', parent: 19, name: 'Eigenvalues & Eigenvectors', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 22, type: 'topic', name: 'Calculus', parent: 18, children: [23, 24, 25] },
                { id: 23, type: 'subtopic', parent: 22, name: 'Limits, Continuity & Differentiability', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 24, type: 'subtopic', parent: 22, name: 'Integration', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 25, type: 'subtopic', parent: 22, name: 'Differential Equations', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 26, type: 'topic', name: 'Probability & Statistics', parent: 18, children: [27, 28, 29] },
                { id: 27, type: 'subtopic', parent: 26, name: 'Probability & Random Variables', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 28, type: 'subtopic', parent: 26, name: 'Distributions', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 29, type: 'subtopic', parent: 26, name: 'Covariance & Correlation', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },

                { id: 30, type: 'subject', name: 'Computer Science (CSE)', children: [31, 35, 39, 43, 47, 51, 55, 59, 63] },
                { id: 31, type: 'topic', name: 'Discrete Mathematics', parent: 30, children: [32, 33, 34] },
                { id: 32, type: 'subtopic', parent: 31, name: 'Set Theory & Logic', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 33, type: 'subtopic', parent: 31, name: 'Graph Theory', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 34, type: 'subtopic', parent: 31, name: 'Combinatorics & Recurrence Relations', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 35, type: 'topic', name: 'Data Structures', parent: 30, children: [36, 37, 38] },
                { id: 36, type: 'subtopic', parent: 35, name: 'Arrays, Linked Lists, Stacks, Queues', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 37, type: 'subtopic', parent: 35, name: 'Trees, Heaps & Hashing', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 38, type: 'subtopic', parent: 35, name: 'Graphs', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 39, type: 'topic', name: 'Algorithms', parent: 30, children: [40, 41, 42] },
                { id: 40, type: 'subtopic', parent: 39, name: 'Sorting & Searching', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 41, type: 'subtopic', parent: 39, name: 'Asymptotic Analysis', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 42, type: 'subtopic', parent: 39, name: 'Dynamic Programming & Greedy', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 43, type: 'topic', name: 'Computer Organization & Architecture', parent: 30, children: [44, 45, 46] },
                { id: 44, type: 'subtopic', parent: 43, name: 'Pipelining', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 45, type: 'subtopic', parent: 43, name: 'I/O Interfacing', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 46, type: 'subtopic', parent: 43, name: 'Memory Hierarchy', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 47, type: 'topic', name: 'Operating Systems', parent: 30, children: [48, 49, 50] },
                { id: 48, type: 'subtopic', parent: 47, name: 'Processes & Threads', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 49, type: 'subtopic', parent: 47, name: 'CPU Scheduling', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 50, type: 'subtopic', parent: 47, name: 'Memory Management', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 51, type: 'topic', name: 'Databases', parent: 30, children: [52, 53, 54] },
                { id: 52, type: 'subtopic', parent: 51, name: 'ER & Relational Model', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 53, type: 'subtopic', parent: 51, name: 'SQL & Normalization', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 54, type: 'subtopic', parent: 51, name: 'Transactions & Concurrency Control', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 55, type: 'topic', name: 'Computer Networks', parent: 30, children: [56, 57, 58] },
                { id: 56, type: 'subtopic', parent: 55, name: 'TCP/IP Protocol Stack', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 57, type: 'subtopic', parent: 55, name: 'Routing Protocols', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 58, type: 'subtopic', parent: 55, name: 'Security', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 59, type: 'topic', name: 'Theory of Computation', parent: 30, children: [60, 61, 62] },
                { id: 60, type: 'subtopic', parent: 59, name: 'Finite Automata & Regular Languages', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 61, type: 'subtopic', parent: 59, name: 'Pushdown Automata & Context-Free Languages', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 62, type: 'subtopic', parent: 59, name: 'Turing Machines & Undecidability', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 63, type: 'topic', name: 'Compiler Design', parent: 30, children: [64, 65, 66] },
                { id: 64, type: 'subtopic', parent: 63, name: 'Lexical Analysis & Parsing', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 65, type: 'subtopic', parent: 63, name: 'Syntax Directed Translation', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 66, type: 'subtopic', parent: 63, name: 'Code Generation & Optimization', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },

                { id: 67, type: 'subject', name: 'Data Science & AI (DA)', children: [68, 72, 76, 80, 84] },
                { id: 68, type: 'topic', name: 'Statistics, Probability & Linear Algebra', parent: 67, children: [69, 70, 71] },
                { id: 69, type: 'subtopic', parent: 68, name: 'Descriptive Statistics', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 70, type: 'subtopic', parent: 68, name: 'Probability Distributions', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 71, type: 'subtopic', parent: 68, name: 'Vector Spaces & Matrix Algebra', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 72, type: 'topic', name: 'Machine Learning', parent: 67, children: [73, 74, 75] },
                { id: 73, type: 'subtopic', parent: 72, name: 'Supervised & Unsupervised Learning', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 74, type: 'subtopic', parent: 72, name: 'Regression & Classification', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 75, type: 'subtopic', parent: 72, name: 'Overfitting & Underfitting', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 76, type: 'topic', name: 'Database Management & Warehousing', parent: 67, children: [77, 78, 79] },
                { id: 77, type: 'subtopic', parent: 76, name: 'SQL Queries', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 78, type: 'subtopic', parent: 76, name: 'Data Warehousing Concepts', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 79, type: 'subtopic', parent: 76, name: 'ETL', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 80, type: 'topic', name: 'AI, NLP & ML (Advanced Topics)', parent: 67, children: [81, 82, 83] },
                { id: 81, type: 'subtopic', parent: 80, name: 'Neural Networks', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 82, type: 'subtopic', parent: 80, name: 'Deep Learning & Reinforcement Learning', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 83, type: 'subtopic', parent: 80, name: 'Natural Language Processing', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 84, type: 'topic', name: 'Data Structures & Algorithms (Advanced)', parent: 67, children: [85, 86] },
                { id: 85, type: 'subtopic', parent: 84, name: 'Advanced Sorting & Graph Algorithms', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
                { id: 86, type: 'subtopic', parent: 84, name: 'Search Algorithms', status: 'Not Started', completionDate: '', revisions: 0, pyqs: '', mocks: '', notes: '', dpp1: '', dpp2: '' },
            ];
            updateDataInFirestore();
        }
        
        function setupEventListeners() {
            const trackerList = document.getElementById('tracker-list');
            trackerList.addEventListener('change', (e) => {
                if (e.target.classList.contains('status-select')) {
                    const id = parseInt(e.target.dataset.id);
                    const item = trackerData.find(i => i.id === id);
                    item.status = e.target.value;
                    if(e.target.value === 'Completed' && !item.completionDate) {
                        item.completionDate = new Date().toISOString().split('T')[0];
                        renderTrackerList();
                    }
                    updateParentStatus(item.parent);
                    updateDataInFirestore();
                } else if(e.target.classList.contains('date-input')) {
                    const id = parseInt(e.target.dataset.id);
                    trackerData.find(i => i.id === id).completionDate = e.target.value;
                    updateDataInFirestore();
                }
            });

            trackerList.addEventListener('input', (e) => {
                if (e.target.classList.contains('notes-input') || e.target.classList.contains('pyqs-input') || e.target.classList.contains('mocks-input') || e.target.classList.contains('dpp1-input') || e.target.classList.contains('dpp2-input')) {
                    const id = parseInt(e.target.dataset.id);
                    const key = e.target.dataset.key;
                    trackerData.find(i => i.id === id)[key] = e.target.value;
                    // Debounce this to avoid too many writes
                    clearTimeout(e.target.dataset.timeout);
                    e.target.dataset.timeout = setTimeout(() => {
                        updateDataInFirestore();
                    }, 1000);
                }
            });

            trackerList.addEventListener('click', (e) => {
                const button = e.target.closest('.revision-btn');
                if (button) {
                    const id = parseInt(button.dataset.id);
                    const action = button.dataset.action;
                    const item = trackerData.find(i => i.id === id);
                    if (action === 'increase') {
                        item.revisions++;
                    } else if (action === 'decrease' && item.revisions > 0) {
                        item.revisions--;
                    }
                    document.querySelector(`.revision-count[data-id="${id}"]`).textContent = item.revisions;
                    updateDataInFirestore();
                } else if (e.target.closest('.subject-header, .topic-header')) {
                     const header = e.target.closest('.subject-header, .topic-header');
                     const contentId = header.dataset.controls;
                     document.getElementById(contentId).classList.toggle('hidden');
                     header.querySelector('.toggle-icon').classList.toggle('rotate-90');
                }
            });

            document.getElementById('filter-buttons').addEventListener('click', (e) => {
                if(e.target.tagName === 'BUTTON') {
                    currentFilter = e.target.dataset.filter;
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active', 'bg-amber-600', 'text-white');
                        btn.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    e.target.classList.add('active', 'bg-amber-600', 'text-white');
                    e.target.classList.remove('bg-gray-200', 'text-gray-700');
                    renderTrackerList();
                }
            });
        }
        
        function getSubtopicProgress(childrenIds) {
            const subtopics = childrenIds.map(id => trackerData.find(i => i.id === id))
                                        .flatMap(item => item && item.type === 'subtopic' ? [item] : (item && item.children ? getSubtopicProgress(item.children) : []));
            const total = subtopics.length;
            if (total === 0) return { mastered: 0, total: 0 };
            const mastered = subtopics.filter(s => s.status === 'Mastered').length;
            return { mastered, total };
        }


        function renderTrackerList() {
            const listContainer = document.getElementById('tracker-list');
            let html = '';
            
            const subjects = trackerData.filter(item => item.type === 'subject');

            subjects.forEach(subject => {
                 if (currentFilter !== 'All' && subject.name !== currentFilter) {
                    return;
                }
                const { mastered, total } = getSubtopicProgress(subject.children);
                const progress = total > 0 ? Math.round((mastered / total) * 100) : 0;


                html += `
                    <div class="bg-gray-50 rounded-lg border border-gray-200">
                        <div class="subject-header p-4 flex justify-between items-center" data-controls="content-${subject.id}">
                            <div class="flex items-center gap-4">
                               <span class="toggle-icon transition-transform transform">&#9654;</span>
                                <h3 class="font-bold text-lg text-gray-700">${subject.name}</h3>
                            </div>
                            <div class="flex items-center gap-3 text-sm">
                                <span>${mastered}/${total} Mastered</span>
                                <div class="w-24 bg-gray-200 rounded-full h-2.5">
                                    <div class="bg-amber-500 h-2.5 rounded-full" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        </div>
                        <div id="content-${subject.id}" class="hidden px-4 pb-2">`;
                
                subject.children.forEach(topicId => {
                    const topic = trackerData.find(item => item.id === topicId);
                    if (!topic) return;
                    const { mastered: topicMastered, total: topicTotal } = getSubtopicProgress(topic.children);
                    const topicProgress = topicTotal > 0 ? Math.round((topicMastered / topicTotal) * 100) : 0;
                    
                    html += `
                        <div class="ml-4 my-2 border-l-2 border-gray-300">
                             <div class="topic-header pl-4 py-2 flex justify-between items-center" data-controls="content-${topic.id}">
                                <div class="flex items-center gap-3">
                                   <span class="toggle-icon transition-transform transform">&#9654;</span>
                                   <h4 class="font-semibold text-md text-gray-600">${topic.name}</h4>
                                </div>
                                <div class="flex items-center gap-3 text-xs">
                                    <span>${topicMastered}/${topicTotal}</span>
                                     <div class="w-20 bg-gray-200 rounded-full h-2">
                                        <div class="bg-amber-500 h-2 rounded-full" style="width: ${topicProgress}%"></div>
                                    </div>
                                </div>
                            </div>
                            <div id="content-${topic.id}" class="hidden pl-8 pb-2">
                                <div class="space-y-4 pt-2">`;

                    topic.children.forEach(subtopicId => {
                        const subtopic = trackerData.find(item => item.id === subtopicId);
                        if (!subtopic) return;
                        html += createSubtopicHTML(subtopic);
                    });

                    html += `</div></div></div>`;
                });

                html += `</div></div>`;
            });

            listContainer.innerHTML = html;
        }

        function createSubtopicHTML(subtopic) {
            const statusColor = statusConfig[subtopic.status].color;
            return `
                <div class="p-4 bg-white rounded-md border border-gray-200 shadow-sm">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                             <div class="status-dot ${statusColor}"></div>
                            <span class="font-medium text-gray-800">${subtopic.name}</span>
                        </div>
                        <select data-id="${subtopic.id}" class="status-select text-xs p-1 rounded border-gray-300">
                            ${Object.keys(statusConfig).map(s => `<option value="${s}" ${subtopic.status === s ? 'selected' : ''}>${s}</option>`).join('')}
                        </select>
                    </div>
                    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 text-sm">
                        <div>
                            <label class="block font-semibold text-gray-500 text-xs">Completion Date</label>
                            <input type="date" data-id="${subtopic.id}" value="${subtopic.completionDate}" class="date-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs">
                        </div>
                        <div>
                            <label class="block font-semibold text-gray-500 text-xs">Revisions</label>
                            <div class="flex items-center mt-1">
                                <button data-id="${subtopic.id}" data-action="decrease" class="revision-btn px-2 border rounded-l-md bg-gray-100">-</button>
                                <span data-id="${subtopic.id}" class="revision-count px-3 border-t border-b">${subtopic.revisions}</span>
                                <button data-id="${subtopic.id}" data-action="increase" class="revision-btn px-2 border rounded-r-md bg-gray-100">+</button>
                            </div>
                        </div>
                        <div>
                            <label class="block font-semibold text-gray-500 text-xs">DPP 1 (Basic)</label>
                            <input type="text" data-id="${subtopic.id}" data-key="dpp1" value="${subtopic.dpp1}" placeholder="e.g. 15/20" class="dpp1-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs">
                        </div>
                        <div>
                            <label class="block font-semibold text-gray-500 text-xs">DPP 2 (Advanced)</label>
                            <input type="text" data-id="${subtopic.id}" data-key="dpp2" value="${subtopic.dpp2}" placeholder="e.g. 10/15" class="dpp2-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs">
                        </div>
                        <div>
                            <label class="block font-semibold text-gray-500 text-xs">PYQ's</label>
                            <input type="text" data-id="${subtopic.id}" data-key="pyqs" value="${subtopic.pyqs}" placeholder="e.g. 20/25" class="pyqs-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs">
                        </div>
                         <div>
                            <label class="block font-semibold text-gray-500 text-xs">Mock Tests</label>
                            <input type="text" data-id="${subtopic.id}" data-key="mocks" value="${subtopic.mocks}" placeholder="e.g. 85%" class="mocks-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs">
                        </div>
                        <div class="col-span-2 md:col-span-4 lg:col-span-1">
                            <label class="block font-semibold text-gray-500 text-xs">Notes</label>
                            <textarea data-id="${subtopic.id}" data-key="notes" placeholder="Key formulas, weak areas..." class="notes-input mt-1 w-full p-1 border rounded-md border-gray-300 text-xs h-12 resize-none">${subtopic.notes}</textarea>
                        </div>
                    </div>
                </div>`;
        }
        
        function updateParentStatus(parentId) {
            if (!parentId) return;

            const parent = trackerData.find(i => i.id === parentId);
            if (!parent) return;
            const children = parent.children.map(id => trackerData.find(i => i.id === id));
            
            const allMastered = children.every(child => child && child.status === 'Mastered');
            const someInProgress = children.some(child => child && child.status !== 'Not Started');
            
            let newStatus;
            if (allMastered) {
                newStatus = 'Mastered';
            } else if (someInProgress) {
                newStatus = 'In Progress';
            } else {
                newStatus = 'Not Started';
            }
            
            if (parent.status !== newStatus) {
                parent.status = newStatus;
                if (parent.parent) {
                    updateParentStatus(parent.parent);
                }
            }
        }

        function updateSummary() {
            const subtopics = trackerData.filter(i => i.type === 'subtopic');
            const counts = {
                "Mastered": 0,
                "In Progress": 0,
                "Completed": 0,
                "Revised": 0,
                "Not Started": 0
            };
            if (subtopics.length > 0) {
                 subtopics.forEach(s => {
                    counts[s.status]++;
                });
            } else {
                counts['Not Started'] = 1;
            }

            document.getElementById('mastered-count').textContent = counts['Mastered'];
            document.getElementById('in-progress-count').textContent = counts['In Progress'];
            document.getElementById('completed-count').textContent = counts['Completed'] + counts['Revised'] + counts['Mastered'];
            document.getElementById('not-started-count').textContent = counts['Not Started'];
            
            const chartData = [
                counts['Not Started'],
                counts['In Progress'],
                counts['Completed'],
                counts['Revised'],
                counts['Mastered']
            ];

            progressChart.data.datasets[0].data = chartData;
            progressChart.update();
        }

        function setupChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Not Started', 'In Progress', 'Completed', 'Revised', 'Mastered'],
                    datasets: [{
                        label: 'Topics',
                        data: [1, 1, 1, 1, 1],
                        backgroundColor: [
                            '#9CA3AF', // Gray
                            '#3B82F6', // Blue
                            '#6366F1', // Indigo
                            '#A855F7', // Purple
                            '#22C55E'  // Green
                        ],
                        borderColor: '#FDFBF8',
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 20,
                                boxWidth: 12,
                                font: {
                                    size: 14
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += context.parsed + ' topics';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            background-color: #FDFBF8;
            font-family: 'Inter', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #d4c4b3;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #bca994;
        }
        .subject-header, .topic-header {
            cursor: pointer;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-700">GATE 2026 Interactive Preparation Tracker</h1>
            <p class="text-gray-500 mt-2">A dashboard to visualize and manage your CSE & DA exam preparation.</p>
        </header>

        <div class="text-center text-sm mb-4 text-gray-600 font-medium">
            Your unique User ID: <span id="user-id-display" class="font-semibold text-gray-800 break-all">Loading...</span>
        </div>

        <main>
            <!-- Summary Section -->
            <section id="summary" class="mb-8 p-6 bg-white rounded-2xl shadow-sm border border-gray-200">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 text-center">Preparation Overview</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-center">
                    <div class="lg:col-span-1">
                        <div class="grid grid-cols-2 sm:grid-cols-1 gap-4">
                             <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-600">Mastered</h3>
                                <p id="mastered-count" class="text-3xl font-bold text-green-600">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-600">In Progress</h3>
                                <p id="in-progress-count" class="text-3xl font-bold text-blue-600">0</p>
                            </div>
                             <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-600">Completed</h3>
                                <p id="completed-count" class="text-3xl font-bold text-indigo-600">0</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                                <h3 class="text-lg font-semibold text-gray-600">Not Started</h3>
                                <p id="not-started-count" class="text-3xl font-bold text-gray-500">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="md:col-span-1 lg:col-span-3">
                        <div class="chart-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Filters and Tracker Section -->
            <section id="tracker" class="p-6 bg-white rounded-2xl shadow-sm border border-gray-200">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4 sm:mb-0">Syllabus Tracker</h2>
                    <div id="filter-buttons" class="flex flex-wrap gap-2">
                        <button class="filter-btn active bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-medium" data-filter="All">All</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium" data-filter="General Aptitude">General Aptitude</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium" data-filter="Engineering Mathematics">Engg. Mathematics</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium" data-filter="Computer Science (CSE)">CSE Core</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium" data-filter="Data Science & AI (DA)">DA & AI</button>
                    </div>
                </div>
                <div id="tracker-list" class="space-y-3">
                    <!-- JS will populate this -->
                </div>
            </section>
        </main>
    </div>
</body>
</html>
